{
  "title": "Threema App Remote Protocol (ARP)",
  "description": "The protocol used to exchange data between the Threema app and a client (e.g. [Threema Web](https://threema.ch/en/threema-web)).",
  "version": "2.0.0",
  "sharedFields": {
    "success": {
      "field": "success",
      "description": "Whether the action was successful.",
      "type": "Boolean",
      "optional": false,
      "nullable": false
    },
    "error": {
      "field": "error",
      "description": "An error code (if the action failed)",
      "type": "String",
      "optional": true,
      "nullable": false
    },
    "receiverId": {
      "field": "id",
      "description": "The identity of the receiver",
      "type": "String",
      "optional": false,
      "nullable": false
    },
    "receiverType": {
      "field": "type",
      "description": "The receiver type",
      "type": "String",
      "enum": ["\"me\"", "\"contact\"", "\"group\"", "\"distributionList\""],
      "optional": false,
      "nullable": false
    },
    "receiverTypeWithoutMe": {
      "field": "type",
      "description": "The receiver type",
      "type": "String",
      "enum": ["\"contact\"", "\"group\"", "\"distributionList\""],
      "optional": false,
      "nullable": false
    },
    "temporaryId": {
      "field": "temporaryId",
      "description": "The temporary ID from the request that was sent by the client.",
      "type": "String",
      "optional": false,
      "nullable": false
    }
  },
  "models": {
    "Quote": {
      "fields": [
        {
          "field": "identity",
          "description": "The identity of the quote text author",
          "type": "String",
          "optional": false,
          "nullable": false
        },
        {
          "field": "text",
          "description": "The quote text",
          "type": "String",
          "optional": false,
          "nullable": false
        }
      ]
    },
    "Contact": {
      "fields": [
        {
          "field": "id",
          "description": "The Threema identity",
          "type": "String",
          "optional": false,
          "nullable": false
        },
        {
          "field": "displayName",
          "description": "The display name of the contact",
          "type": "String",
          "optional": false,
          "nullable": false
        },
        {
          "field": "color",
          "description": "The contact color in hex notation (e.g. `\"#1122FF\"`)",
          "type": "String",
          "optional": true,
          "nullable": false
        },
        {
          "field": "firstName",
          "description": "The contact first name",
          "type": "String",
          "optional": true,
          "nullable": false
        },
        {
          "field": "lastName",
          "description": "The contact last name",
          "type": "String",
          "optional": true,
          "nullable": false
        },
        {
          "field": "publicNickname",
          "description": "The contact public nickname (without preceding `~`)",
          "type": "String",
          "optional": true,
          "nullable": false
        },
        {
          "field": "verificationLevel",
          "description": "The verification level<br>1: Unverified (red)<br>2: Server verified (yellow)<br>3: Fully verified (green)",
          "type": "Integer",
          "enum": [1, 2, 3],
          "optional": false,
          "nullable": false
        },
        {
          "field": "state",
          "description": "The identity state",
          "type": "String",
          "enum": ["\"ACTIVE\"", "\"INACTIVE\""],
          "optional": false,
          "nullable": false
        },
        {
          "field": "featureMask",
          "description": "The feature mask (TODO: Document)",
          "type": "Integer",
          "optional": false,
          "nullable": false
        },
        {
          "field": "isWork",
          "description": "Whether this is a contact from the same Threema Work package.<br>Only relevant for Threema Work users.",
          "type": "Boolean",
          "optional": true,
          "nullable": false
        },
        {
          "field": "identityType",
          "description": "The identity type<br>0: Regular Threema user<br>1: Threema Work user",
          "type": "Integer",
          "enum": [0, 1],
          "optional": false,
          "nullable": false
        },
        {
          "field": "publicKey",
          "description": "The contact public key",
          "type": "Binary",
          "optional": false,
          "nullable": false
        },
        {
          "field": "locked",
          "description": "Whether the chat with this contact is locked. This is used for private chats.",
          "type": "Boolean",
          "optional": false,
          "nullable": false
        },
        {
          "field": "visible",
          "description": "Whether the chat with this contact is visible. This is used for private chats.",
          "type": "Boolean",
          "optional": false,
          "nullable": false
        },
        {
          "field": "hidden",
          "description": "The contact is hidden (e.g. because it is part of a group, but was never added to the address book or contacted)",
          "type": "Boolean",
          "optional": false,
          "nullable": false
        },
        {
          "field": "access",
          "description": "The access object",
          "type": "Map<Access> (TODO)",
          "optional": false,
          "nullable": false
        }
      ]
    }
  },
  "messages": {
    "create": {
      "contact": [
        {
          "direction": "fromapp",
          "summary": "Respond to a `create/contact` message.",
          "args": {
            "fields": [
              "@temporaryId",
              {
                "field": "identity",
                "description": "The identity of the contact that was created",
                "type": "String",
                "optional": false,
                "nullable": false
              },
              "@success",
              "@error"
            ]
          },
          "data": {
            "description": "If `success=true`, send the following map, otherwise send no data field.",
            "fields": [
              {
                "field": "receiver",
                "description": "The contact",
                "type": "Map<Contact>",
                "optional": false,
                "nullable": false
              }
            ]
          },
          "models": ["Contact"],
          "errorCodes": {
            "codes": {
              "invalidIdentity": "The identity is invalid",
              "disabledByPolicy": "Feature disabled by administrator",
              "internalError": "The contact could not be created due to an internal error"
            }
          }
        },
        {
          "direction": "toapp",
          "summary": "Create a new contact.",
          "args": {
            "fields": [
              "@temporaryId"
            ]
          },
          "data": {
            "fields": [
              {
                "field": "identity",
                "description": "The identity of the contact that should be created",
                "type": "String",
                "optional": false,
                "nullable": false
              }
            ]
          }
        }
      ],
      "distributionList": [
        {
          "direction": "fromapp",
          "summary": "Respond to a `create/distributionList` message.",
          "args": {
            "fields": [
              "@temporaryId",
              "@success",
              "@error"
            ]
          },
          "data": {
            "description": "If `success=true`, send the following map, otherwise send no data field.",
            "fields": [
              {
                "field": "receiver",
                "description": "The distribution list",
                "type": "Map<DistributionList>",
                "optional": false,
                "nullable": false
              }
            ]
          },
          "errorCodes": {
            "codes": {
              "badRequest": "Invalid request",
              "internalError": "The distribution list could not be created due to an internal error"
            }
          }
        },
        {
          "direction": "toapp",
          "summary": "Create a new distribution list.",
          "args": {
            "fields": [
              "@temporaryId"
            ]
          },
          "data": {
            "fields": [
              {
                "field": "members",
                "description": "The list of distribution list member identities",
                "type": "Array<String>",
                "optional": false,
                "nullable": false
              },
              {
                "field": "name",
                "description": "The distribution list name",
                "type": "String",
                "optional": true,
                "nullable": false
              }
            ]
          }
        }
      ],
      "fileMessage": [
        {
          "direction": "fromapp",
          "summary": "Notify the client that a new message was created. This is a reply to the `create/fileMessage` message from the client.",
          "args": {
            "fields": [
              "@receiverType",
              "@receiverId",
              "@temporaryId",
              {
                "field": "success",
                "description": "Whether the message was sent successfully",
                "type": "Boolean",
                "optional": false,
                "nullable": false
              }
            ]
          },
          "data": {
            "fields": [
              {
                "field": "messageId",
                "description": "The message id of the new message",
                "type": "String",
                "optional": false,
                "nullable": false
              }
            ]
          }
        },
        {
          "direction": "toapp",
          "summary": "Send a new file message",
          "args": {
            "fields": [
              "@receiverType",
              "@receiverId",
              "@temporaryId"
            ]
          },
          "data": {
            "fields": [
              {
                "field": "name",
                "description": "The filename",
                "type": "String",
                "optional": false,
                "nullable": false
              },
              {
                "field": "fileType",
                "description": "The MIME type of the file",
                "type": "String",
                "optional": false,
                "nullable": false
              },
              {
                "field": "sendAsFile",
                "description": "Force-send this item as file, even if it's an image or audio file",
                "type": "Boolean",
                "optional": false,
                "nullable": false
              },
              {
                "field": "size",
                "description": "The file size in bytes",
                "type": "Integer",
                "optional": false,
                "nullable": false
              },
              {
                "field": "caption",
                "description": "Caption of the message",
                "type": "String",
                "optional": true,
                "nullable": false
              }
            ]
          }
        }
      ],
      "group": [
        {
          "direction": "fromapp",
          "summary": "Respond to a `create/group` message.",
          "args": {
            "fields": [
              "@temporaryId",
              "@success",
              "@error"
            ]
          },
          "data": {
            "description": "If `success=true`, send the following map, otherwise send no data field.",
            "fields": [
              {
                "field": "receiver",
                "description": "The group",
                "type": "Map<Group>",
                "optional": false,
                "nullable": false
              }
            ]
          },
          "errorCodes": {
            "codes": {
              "disabledByPolicy": "Group creation was disabled by the administrator",
              "badRequest": "Invalid request",
              "internalError": "The group could not be created due to an internal error"
            }
          }
        },
        {
          "direction": "toapp",
          "summary": "Create a new group.",
          "args": {
            "fields": [
              "@temporaryId"
            ]
          },
          "data": {
            "fields": [
              {
                "field": "members",
                "description": "The list of group member identities",
                "type": "Array<String>",
                "optional": false,
                "nullable": false
              },
              {
                "field": "name",
                "description": "The group name",
                "type": "String",
                "optional": true,
                "nullable": false
              },
              {
                "field": "avatar",
                "description": "The group avatar",
                "type": "Binary",
                "optional": true,
                "nullable": false
              }
            ]
          }
        }
      ],
      "textMessage": [
        {
          "direction": "fromapp",
          "summary": "Notify the client that a new message was created. This is a reply to the `create/textMessage` message from the client.",
          "args": {
            "fields": [
              "@receiverType",
              "@receiverId",
              "@temporaryId",
              {
                "field": "success",
                "description": "Whether the message was sent successfully",
                "type": "Boolean",
                "optional": false,
                "nullable": false
              }
            ]
          },
          "data": {
            "fields": [
              {
                "field": "messageId",
                "description": "The message id of the new message",
                "type": "String",
                "optional": false,
                "nullable": false
              }
            ]
          }
        },
        {
          "direction": "toapp",
          "summary": "Send a new text message.",
          "args": {
            "fields": [
              "@receiverType",
              "@receiverId",
              "@temporaryId"
            ]
          },
          "data": {
            "fields": [
              {
                "field": "text",
                "description": "The message text",
                "type": "String",
                "optional": false,
                "nullable": false
              },
              {
                "field": "quote",
                "description": "The quote",
                "type": "Map<Quote>",
                "optional": true,
                "nullable": false
              }
            ]
          },
          "models": ["Quote"]
        }
      ]
    },
    "delete": {
      "cleanReceiverConversation": [
        {
          "direction": "toapp",
          "summary": "Delete all messages in a conversation.",
          "args": {
            "fields": [
              "@receiverId",
              "@receiverTypeWithoutMe",
              "@temporaryId"
            ]
          },
          "errorCodes": {
            "codes": {
              "invalidIdentity": "Receiver with the specified id not found",
              "badRequest": "Invalid request",
              "internalError": "An internal error occurred"
            }
          }
        }
      ],
      "distributionList": [
        {
          "direction": "toapp",
          "summary": "Delete a distribution list.",
          "args": {
            "fields": [
              "@receiverId",
              "@temporaryId"
            ]
          },
          "errorCodes": {
            "codes": {
              "invalidDistributionList": "Distribution list not found",
              "badRequest": "Invalid request",
              "internalError": "The distribution list not be deleted due to an internal error"
            }
          }
        }
      ],
      "group": [
        {
          "direction": "toapp",
          "summary": "Leave or delete a group.",
          "response": "Either a `delete/group` or an `update/group` message will be sent by the app.",
          "args": {
            "fields": [
              "@receiverId",
              {
                "field": "deleteType",
                "description": "The type of deletion",
                "type": "String",
                "enum": ["\"leave\"", "\"delete\""],
                "optional": false,
                "nullable": false
              },
              "@temporaryId"
            ]
          },
          "errorCodes": {
            "codes": {
              "invalidGroup": "Group not found",
              "alreadyLeft": "You already left this group",
              "notAllowed": "Only the admin is allowed to delete a group",
              "badRequest": "Invalid argument"
            }
          }
        }
      ],
      "message": [
        {
          "direction": "toapp",
          "summary": "Delete a message.",
          "response": "The app responds with a `confirmAction` message.",
          "args": {
            "fields": [
              "@receiverType",
              "@receiverId",
              {
                "field": "messageId",
                "description": "The message id",
                "type": "String",
                "optional": false,
                "nullable": false
              },
              "@temporaryId"
            ]
          },
          "errorCodes": {
            "codes": {
              "invalidMessage": "Message with the specified type / id / messageId was not found",
              "badRequest": "Invalid request"
            }
          }
        }
      ]
    }
  }
}
